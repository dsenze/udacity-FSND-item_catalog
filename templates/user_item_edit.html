<html>
  <head>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"> defer
    </script>
    <script>
      $(document).ready(function() {
	      var funcOne = function() {
        this.sharedVal = 'stack overflow';
    };
	
	  var updateitem = function() {
		  // all credits to https://stackoverflow.com/questions/44646925/flask-dynamic-dependent-dropdown-list
          var subcategory = $('#subcategory').val();
          // Make Ajax Request and expect JSON-encoded data
          $.getJSON(
            '/subcategory' + '/' + subcategory + '/' + 'itemcategorys/JSON',
            function(data) {

              // Remove old options
              $('#itemcategory').find('option').remove();                                

              // Add new items for itemcategory
              $.each(data, function(key, val) {
			  max = val.length
			  for (i = 0; i < max; i++) {
				 console.log(val[i].name)
				 var option_item = '<option value="' + val[i].id + '">' + val[i].name + '</option>'
                $('#itemcategory').append(option_item);
              }
			  }
               );
			  
            }
          );
		  };
       
	  var updatesub = function() {
		  // all credits to https://stackoverflow.com/questions/44646925/flask-dynamic-dependent-dropdown-list
          var category = $('#category').val();
          // Make Ajax Request and expect JSON-encoded data
          $.getJSON(
            '/category' + '/' + category + '/' + 'subcategorys/JSON',
            function(data) {

              // Remove old optionsa
              $('#subcategory').find('option').remove();                                

              // Add new items for subcategory
              $.each(data, function(key, val) {
			  max = val.length;
			  for (i = 0; i < max; i++) {
				 console.log(val[i].name)
				 var option_item = '<option value="' + val[i].id + '">' + val[i].name + '</option>'
                $('#subcategory').append(option_item);
              }
			  }
               );
			  console.log('updateitem')
            }
         );
		 
		  };	
	// set items current categories
	  var item = $('#category').val();
          $.getJSON(
            '/item' + '/' + {{item.id}} + '/category/name'+'/JSON',
            function(data) {
			  $.each(data, function(key, val) {
			  console.log(val.categoryid)
			  if ($("#category").val() != val.categoryid){
				$("#category").val(val.categoryid);
			  }
			  if ($("#subcategory").val() != val.subcategoryid){
			  	$("#subcategory").val(val.subcategoryid);
			  }
			  if ($("#itemcategory").val() != val.itemcategoryid){
				$("#itemcategory").val(val.itemcategoryid);
			  }
			  })
			  updateitem
            }
			
          );
		console.log(updatesub)
		updateitem
		 //Listener on change
        $('#category').change(updatesub);

		$('#subcategory').change(updateitem);
	  });
    </script>
  </head>

  <body>
       <h1> Edit Item </h1>

    <form action="{{ url_for('editItem',itemid = item.id)}}" method='post'>

        <dl>
            <dt>Name: {{item.id}}</dt>
            <dd><input type='text' size='30' name='name' placeholder='{{item.name}}'></dd>
            <dt>Description:</dt>
            <dd><textarea name='description' rows='5' cols='40' placeholder='{{item.description}}'></textarea></dd>
            <dt>Price:</dt>
            <dd><input type='text' size='8' name='price' placeholder='{{item.price}}'></dd>
			<dt>picture</dt>
			<dd><input type='text' size='8' name='picture' placeholder='{{item.picture}}'></dd>
			
			<select name ="category" id="category">
			{% for x in category %}
				<option value="{{ x.id }}">{{ x.name }}</option>
			{% endfor %}
			</select>
			<select name = "subcategory" id="subcategory">
			{% for x in subcategory %}
				<option value="{{ x.id }}">{{ x.name }}</option>
			{% endfor %}
			</select>
			<select name = "itemcategory" id="itemcategory">
			{% for x in itemcategory %}
				<option value="{{ x.id }}">{{ x.name }}</option>
			{% endfor %}
			</select>


        </dl>


        <input type='submit' value='Edit'>

        <a href='{{url_for('showItems', itemcategoryid = item.itemcategoryid)}}'> Cancel </a>
    </form>
  </body>
</html>